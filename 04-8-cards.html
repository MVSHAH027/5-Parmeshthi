<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eight Cards Swapping</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans+Gujarati:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans Gujarati', sans-serif;
        }
        .tile-text {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        .tile.empty {
            background-image: repeating-linear-gradient(
                45deg,
                rgba(251, 146, 60, 0.1),
                rgba(251, 146, 60, 0.1) 10px,
                rgba(253, 186, 116, 0.1) 10px,
                rgba(253, 186, 116, 0.1) 20px
            );
        }
        .target-grid-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.25rem;
            border: 1px solid #fdba74;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            min-height: 2.5rem;
        }
        .instructions-hidden { /* This class will now hide both instructions and goal */
            display: none;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-orange-200 via-amber-100 to-yellow-200 flex flex-col items-center justify-center min-h-screen p-4 selection:bg-orange-500 selection:text-white">

    <div class="bg-white p-5 sm:p-6 md:p-8 rounded-xl shadow-2xl w-full max-w-md">
        <header class="mb-4 text-center">
            <h1 id="game-title" class="text-2xl sm:text-3xl font-bold text-orange-600">Eight Cards Swapping</h1>
        </header>

        <div class="flex flex-wrap justify-between items-center mb-3 gap-2">
            <div class="flex items-center gap-1">
                <button id="lang-en" class="text-xs sm:text-sm bg-blue-500 hover:bg-blue-600 text-white py-1 px-2 rounded-md">English</button>
                <button id="lang-gu" class="text-xs sm:text-sm bg-green-500 hover:bg-green-600 text-white py-1 px-2 rounded-md">ગુજરાતી</button>
            </div>
            <div class="flex items-center gap-1">
                <button id="toggle-instructions-button" class="text-xs sm:text-sm bg-indigo-500 hover:bg-indigo-600 text-white py-1.5 px-3 rounded-md">
                    {/* Text set by JS */}
                </button>
                <button id="reset-button" class="text-xs sm:text-sm bg-orange-500 hover:bg-orange-600 text-white font-semibold py-1.5 px-3 rounded-lg shadow-md hover:shadow-lg transition-all duration-150 ease-in-out active:transform active:scale-95 focus:outline-none focus:ring-2 focus:ring-orange-400 focus:ring-opacity-75">
                    {/* Text set by JS */}
                </button>
            </div>
        </div>

        <div class="flex justify-between items-center mb-4 px-1 sm:px-2">
            <div class="text-sm sm:text-base text-slate-700">
                <span id="moves-label">Moves</span>: <span id="moves-count" class="font-semibold text-orange-700">0</span>
            </div>
            <div class="text-sm sm:text-base text-slate-700">
                <span id="time-label">Time</span>: <span id="timer-display" class="font-semibold text-orange-700">0s</span>
            </div>
        </div>
        
        <div id="instructions-section" class="mb-3 p-3 bg-blue-50 border border-blue-200 rounded-md instructions-hidden">
            <h3 id="instructions-title" class="text-md font-semibold text-blue-700 mb-2">How to Play:</h3>
            <ol id="instructions-list" class="list-decimal list-inside text-sm text-slate-700 space-y-1">
                {/* Instruction items will be populated by JS */}
            </ol>
        </div>

        <div id="target-order-info" class="mb-3 p-3 bg-orange-50 border border-orange-200 rounded-md instructions-hidden">
            <strong id="goal-label">Goal:</strong>
            <div id="target-grid-display" class="grid grid-cols-3 gap-1 mt-2 text-center mx-auto max-w-[200px] sm:max-w-[240px] border border-orange-200 p-1 rounded">
                {/* Target grid cells will be populated by JS */}
            </div>
        </div>

        <main>
            <div id="grid" class="grid grid-cols-3 gap-1.5 sm:gap-2 p-1.5 sm:p-2 bg-orange-100 rounded-lg shadow-inner mb-4">
                {/* Tiles will be generated by JavaScript */}
            </div>

            <div id="message" class="mt-5 text-center text-lg sm:text-xl font-semibold text-green-600 h-8">
                {/* Win message appears here */}
            </div>
            
        </main>
    </div>

    <script>
        // DOM Elements
        const gridElement = document.getElementById('grid');
        const movesElement = document.getElementById('moves-count');
        const resetButton = document.getElementById('reset-button');
        const messageElement = document.getElementById('message');
        const targetOrderInfoElement = document.getElementById('target-order-info'); // Remains the same
        const timerDisplayElement = document.getElementById('timer-display');
        const gameTitleElement = document.getElementById('game-title');
        const movesLabelElement = document.getElementById('moves-label');
        const timeLabelElement = document.getElementById('time-label');
        const goalLabelElement = document.getElementById('goal-label');
        const targetGridDisplayElement = document.getElementById('target-grid-display');
        const langEnButton = document.getElementById('lang-en');
        const langGuButton = document.getElementById('lang-gu');
        const toggleInstructionsButton = document.getElementById('toggle-instructions-button');
        const instructionsSection = document.getElementById('instructions-section');
        const instructionsTitleElement = document.getElementById('instructions-title');
        const instructionsListElement = document.getElementById('instructions-list');

        // Game constants
        const GRID_SIZE = 3;

        // Tile keys (used internally, mapped to translated names)
        const TILE_KEYS = {
            ARIHANT: "Arihant",
            SIDDHA: "Siddha",
            ACHARYA: "Acharya",
            EMPTY: null 
        };
        
        // The solved state defines the target configuration using TILE_KEYS.
        const solvedState = [
            TILE_KEYS.ARIHANT, TILE_KEYS.EMPTY, TILE_KEYS.ACHARYA,
            TILE_KEYS.ARIHANT, TILE_KEYS.SIDDHA, TILE_KEYS.ACHARYA,
            TILE_KEYS.ARIHANT, TILE_KEYS.SIDDHA, TILE_KEYS.ACHARYA
        ];

        const translations = {
            en: {
                title: "Eight Cards Swapping",
                arihant: "Arihant",
                siddha: "Siddha",
                acharya: "Acharya",
                emptyDisplay: "(Empty)", 
                goal: "Goal:",
                moves: "Moves",
                time: "Time",
                reset: "Reset",
                instructionsTitle: "How to Play:",
                instructions: [
                    "The goal is to arrange the cards as shown in the 'Goal' section.",
                    "Click (or tap) a card next to the empty space to swap it.",
                    "Column 1: Arihant, Arihant, Arihant.",
                    "Column 2: (Empty), Siddha, Siddha.",
                    "Column 3: Acharya, Acharya, Acharya.",
                    "The timer starts after your first move.",
                    "Click 'Reset' to shuffle and start a new game."
                ],
                showInstructions: "Show Instructions & Goal", // Updated button text
                hideInstructions: "Hide Instructions & Goal", // Updated button text
                solvedMessage: (moves, time) => `Solved in ${moves} moves! Time: ${time}s`
            },
            gu: {
                title: "આઠ કાર્ડ અદલાબદલી",
                arihant: "અરિહંત",
                siddha: "સિદ્ધ",
                acharya: "આચાર્ય",
                emptyDisplay: "(ખાલી)",
                goal: "ધ્યેય:",
                moves: "ચાલ",
                time: "સમય",
                reset: "ફરીથી",
                instructionsTitle: "કેવી રીતે રમવું:",
                instructions: [
                    "'ધ્યેય' વિભાગમાં બતાવ્યા પ્રમાણે કાર્ડ ગોઠવવાનું લક્ષ્ય છે.",
                    "ખાલી જગ્યાની બાજુના કાર્ડ પર તેને અદલાબદલ કરવા માટે ક્લિક (અથવા ટેપ) કરો.",
                    "કૉલમ 1: અરિહંત, અરિહંત, અરિહંત.",
                    "કૉલમ 2: (ખાલી), સિદ્ધ, સિદ્ધ.",
                    "કૉલમ 3: આચાર્ય, આચાર્ય, આચાર્ય.",
                    "તમારી પ્રથમ ચાલ પછી ટાઈમર શરૂ થાય છે.",
                    "નવી રમત શફલ કરવા અને શરૂ કરવા માટે 'ફરીથી' ક્લિક કરો."
                ],
                showInstructions: "સૂચનાઓ અને ધ્યેય બતાવો", // Updated button text
                hideInstructions: "સૂચનાઓ અને ધ્યેય છુપાવો", // Updated button text
                solvedMessage: (moves, time) => `${moves} ચાલમાં ઉકેલાયું! સમય: ${time}s`
            }
        };
        let currentLanguage = 'en';

        // Game state variables
        let tiles = []; 
        let emptySlotIndex = -1; 
        let movesCount = 0; 
        let gameWon = false;

        // Timer variables
        let timerInterval = null;
        let secondsElapsed = 0;
        let timerStarted = false;

        /**
         * Updates all UI text elements based on the current language.
         */
        function updateUIText() {
            const currentTranslation = translations[currentLanguage];
            gameTitleElement.textContent = currentTranslation.title;
            movesLabelElement.textContent = currentTranslation.moves;
            timeLabelElement.textContent = currentTranslation.time;
            resetButton.textContent = currentTranslation.reset; 
            goalLabelElement.textContent = currentTranslation.goal;
            instructionsTitleElement.textContent = currentTranslation.instructionsTitle;
            
            instructionsListElement.innerHTML = ''; 
            currentTranslation.instructions.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item;
                instructionsListElement.appendChild(li);
            });

            toggleInstructionsButton.textContent = instructionsSection.classList.contains('instructions-hidden') ? 
                                                  currentTranslation.showInstructions : currentTranslation.hideInstructions;
            
            targetGridDisplayElement.innerHTML = '';
            solvedState.forEach(key => {
                const cell = document.createElement('div');
                cell.classList.add('target-grid-cell', 'tile-text');
                let textContent = '';
                let bgColor = 'bg-white'; 
                if (key === TILE_KEYS.ARIHANT) textContent = currentTranslation.arihant;
                else if (key === TILE_KEYS.SIDDHA) { textContent = currentTranslation.siddha; bgColor = 'bg-red-200';}
                else if (key === TILE_KEYS.ACHARYA) { textContent = currentTranslation.acharya; bgColor = 'bg-yellow-100';}
                else if (key === TILE_KEYS.EMPTY) { textContent = currentTranslation.emptyDisplay; bgColor = 'bg-orange-100';}
                cell.textContent = textContent;
                cell.classList.add(bgColor);
                targetGridDisplayElement.appendChild(cell);
            });
        }
        
        function setLanguage(lang) {
            currentLanguage = lang;
            initGame(); 
        }

        function initGame() {
            movesCount = 0;
            gameWon = false;
            updateMovesDisplay();
            messageElement.textContent = '';
            
            // Ensure both instructions and goal are hidden by default on init/reset
            instructionsSection.classList.add('instructions-hidden'); 
            targetOrderInfoElement.classList.add('instructions-hidden'); 
            
            stopTimer();
            secondsElapsed = 0;
            timerStarted = false;
            updateTimerDisplay();

            shuffleTiles(); 
            renderGrid();
            updateUIText(); // This will set the button text to "Show Instructions & Goal"
        }

        function startTimer() {
            if (timerStarted) return;
            timerStarted = true;
            secondsElapsed = 0;
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                secondsElapsed++;
                updateTimerDisplay();
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
        }

        function updateTimerDisplay() {
            timerDisplayElement.textContent = `${secondsElapsed}s`;
        }

        function shuffleTiles() {
            tiles = [...solvedState]; 
            let currentEmptySlotIndex = tiles.indexOf(TILE_KEYS.EMPTY);

            const shuffleMovesCount = 200; 
            for (let i = 0; i < shuffleMovesCount; i++) {
                const neighbors = getValidMoveNeighbors(currentEmptySlotIndex);
                if (neighbors.length > 0) { 
                    const randomNeighborIndex = neighbors[Math.floor(Math.random() * neighbors.length)];
                    [tiles[currentEmptySlotIndex], tiles[randomNeighborIndex]] = [tiles[randomNeighborIndex], tiles[currentEmptySlotIndex]];
                    currentEmptySlotIndex = randomNeighborIndex;
                }
            }
            emptySlotIndex = currentEmptySlotIndex; 
        }

        function getValidMoveNeighbors(index) {
            const neighbors = [];
            const row = Math.floor(index / GRID_SIZE);
            const col = index % GRID_SIZE;
            if (row > 0) neighbors.push(index - GRID_SIZE);
            if (row < GRID_SIZE - 1) neighbors.push(index + GRID_SIZE);
            if (col > 0) neighbors.push(index - 1);
            if (col < GRID_SIZE - 1) neighbors.push(index + 1);
            return neighbors;
        }
        
        function swapItemsInTilesArray(index1, index2) {
            [tiles[index1], tiles[index2]] = [tiles[index2], tiles[index1]];
        }

        function renderGrid() {
            gridElement.innerHTML = ''; 
            const currentTranslation = translations[currentLanguage];

            tiles.forEach((tileKey, index) => {
                const tileElement = document.createElement('div');
                tileElement.className = 'aspect-square flex items-center justify-center text-xs sm:text-sm md:text-base rounded-md shadow-sm transition-all duration-150 ease-in-out tile-text';

                if (tileKey === TILE_KEYS.EMPTY) {
                    tileElement.classList.add('tile', 'empty', 'bg-orange-200', 'opacity-70', 'cursor-default');
                    tileElement.setAttribute('aria-label', 'Empty slot');
                } else {
                    let tileText = '';
                    if (tileKey === TILE_KEYS.ARIHANT) tileText = currentTranslation.arihant;
                    else if (tileKey === TILE_KEYS.SIDDHA) tileText = currentTranslation.siddha;
                    else if (tileKey === TILE_KEYS.ACHARYA) tileText = currentTranslation.acharya;
                    
                    tileElement.textContent = tileText;
                    tileElement.classList.add('tile', 'font-bold', 'text-black', 'cursor-pointer', 'active:scale-95');
                    tileElement.setAttribute('role', 'button');
                    tileElement.setAttribute('tabindex', '0');

                    if (tileKey === TILE_KEYS.ARIHANT) {
                        tileElement.classList.add('bg-white', 'hover:bg-gray-100', 'active:bg-gray-200');
                    } else if (tileKey === TILE_KEYS.SIDDHA) {
                        tileElement.classList.add('bg-red-400', 'hover:bg-red-500', 'active:bg-red-600');
                    } else if (tileKey === TILE_KEYS.ACHARYA) {
                        tileElement.classList.add('bg-yellow-300', 'hover:bg-yellow-400', 'active:bg-yellow-500');
                    }
                    
                    if (!gameWon) {
                        tileElement.addEventListener('click', () => handleTileClick(index));
                        tileElement.addEventListener('keydown', (e) => {
                            if (e.key === 'Enter' || e.key === ' ') {
                                e.preventDefault(); 
                                handleTileClick(index);
                            }
                        });
                    } else {
                        tileElement.classList.remove('bg-white', 'bg-red-400', 'bg-yellow-300', 'hover:bg-gray-100', 'hover:bg-red-500', 'hover:bg-yellow-400', 'active:bg-gray-200', 'active:bg-red-600', 'active:bg-yellow-500', 'cursor-pointer');
                        tileElement.classList.add('bg-green-100', 'text-green-700', 'cursor-not-allowed', 'opacity-90');
                    }
                }
                gridElement.appendChild(tileElement);
            });
        }

        function handleTileClick(clickedIndex) {
            if (gameWon || tiles[clickedIndex] === TILE_KEYS.EMPTY) return; 

            const rowClicked = Math.floor(clickedIndex / GRID_SIZE);
            const colClicked = clickedIndex % GRID_SIZE;
            const rowEmpty = Math.floor(emptySlotIndex / GRID_SIZE);
            const colEmpty = emptySlotIndex % GRID_SIZE;

            const isAdjacent = (Math.abs(rowClicked - rowEmpty) === 1 && colClicked === colEmpty) ||
                               (Math.abs(colClicked - colEmpty) === 1 && rowClicked === rowEmpty);

            if (isAdjacent) {
                swapItemsInTilesArray(clickedIndex, emptySlotIndex);
                emptySlotIndex = clickedIndex; 
                movesCount++;
                updateMovesDisplay();

                if (movesCount === 1 && !timerStarted) {
                    startTimer();
                }
                renderGrid(); 
                checkWin();
            }
        }

        function updateMovesDisplay() {
            movesElement.textContent = movesCount;
        }

        function checkWin() {
            for (let i = 0; i < solvedState.length; i++) {
                if (tiles[i] !== solvedState[i]) {
                    return false; 
                }
            }
            
            gameWon = true; 
            stopTimer(); 
            messageElement.textContent = translations[currentLanguage].solvedMessage(movesCount, secondsElapsed);
            
            // Hide instructions and goal when game is won
            instructionsSection.classList.add('instructions-hidden');
            targetOrderInfoElement.classList.add('instructions-hidden');
            // Update button text to "Show" state
            toggleInstructionsButton.textContent = translations[currentLanguage].showInstructions;

            renderGrid(); 
            return true;
        }

        // Event Listeners
        resetButton.addEventListener('click', initGame);
        langEnButton.addEventListener('click', () => setLanguage('en'));
        langGuButton.addEventListener('click', () => setLanguage('gu'));
        
        toggleInstructionsButton.addEventListener('click', () => {
            instructionsSection.classList.toggle('instructions-hidden');
            targetOrderInfoElement.classList.toggle('instructions-hidden'); // Toggle goal section as well

            const currentTranslation = translations[currentLanguage];
            if (instructionsSection.classList.contains('instructions-hidden')) {
                toggleInstructionsButton.textContent = currentTranslation.showInstructions;
            } else {
                toggleInstructionsButton.textContent = currentTranslation.hideInstructions;
            }
        });

        // Initial game setup
        document.addEventListener('DOMContentLoaded', () => {
            setLanguage('en'); 
        });
    </script>

</body>
</html>
